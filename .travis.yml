# Copyright (c) 2017-2019 The University of Manchester
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

dist: focal
language: c
addons:
  apt:
    sources:
      - sourceline: 'deb http://us.archive.ubuntu.com/ubuntu/ trusty universe'
    packages:
      - vera++
      - gcc-arm-none-eabi
      - libnewlib-arm-none-eabi
      - openjdk-8-jre-headless
      - ant

before_install:
  - git clone https://github.com/SpiNNakerManchester/SupportScripts.git support
  - python support/travis_blocking_stdout.py
  - support/rat.sh download

install:
  - support/gitclone.sh https://github.com/SpiNNakerManchester/spinnaker_tools.git
  - export SPINN_DIRS=`pwd`/spinnaker_tools GNU=1
  - make -C spinnaker_tools/sark
  - make -C spinnaker_tools/spin1_api

script:
  - CFLAGS=-fdiagnostics-color make
  - make install
  # Code style
  - support/run-vera.sh include -P max-file-length=2500
  - support/run-vera.sh src
  # Copyright check
  - support/rat.sh run
